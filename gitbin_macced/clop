#!/bin/bash
clear
function whatis() {
	cuseco=$(basename $0)
    echo -e "\\033[38;5;118m${cuseco}	‚Üí \\033[38;5;11mtype:\\033[38;5;118mvio bas-admin: select, vim, clog, opt ‚Üí sed p"
	echo -e "\\033[38;5;118m ‚áí  \\\033[38;5;195mclog like a pro ‚Üí hay un clog maestro por cada step del d√≠a horariado, y\\033[38;5;212m ${cuseco} \\033[38;5;195mpuede ‚Üí 
	\033[38;5;11m¬ª \\033[38;5;195mselect and vim \\033[38;5;11mel \\033[38;5;208mprimer log.maestro \\033[38;5;11mdel d√≠a ‚≠ê
	\033[38;5;11m¬ª en los entrehorariados \\033[38;5;195mvim el \\033[38;5;208mcurrent log.maestro \\033[38;5;195mpara edit ANTES de cerrarlo, editado con el trabajo reciente, para POSTERIOR VISTAZO antes del trabajo del nuevo d√≠a
		\033[38;5;11m¬ª \\033[38;5;195my seguido select and vim \\033[38;5;208mnuevo log.maestro
	\033[38;5;11m¬ª \\033[38;5;195mY para un \\033[38;5;14m\`vistazo\` \\033[38;5;195men cualquier momento, clop con \\033[38;5;14mave \\033[38;5;195mcomo argumento 
		\033[38;5;11m¬ª \\033[38;5;14mselect and sed-print el √∫ltimo d√≠a
\033[38;5;43m\tüëâ\t\033[38;5;118m${cuseco} ave\033[0m
		‚≠ê \033[38;5;11mMUY IMPORTANTE ‚Üí seguir el procedimiento: 
   		\033[38;5;118m ‚áí  para activar la \\033[38;5;11mSE√ëAL\\033[38;5;118m, una boolean de .bashrc que se flipa con sed en either un script or un alias 
	\033[38;5;11m¬ª \\033[38;5;118mclop \\033[38;5;195mpara empezar: al empezar el d√≠a selecciono un log.maestro, y le hecho un vistazo; la \\033[38;5;11mse√±al \\033[38;5;118mseta al select as \\033[38;5;218mtrue \\033[38;5;11m‚Üí oclog.persistent.history \\033[38;5;118m‚àö‚àö‚àö 
	\033[38;5;11m¬ª \\033[38;5;118mclop \\033[38;5;195ma lo largo del d√≠a: nuevas selecciones, un vistazo, y reseteo de \\033[38;5;11mse√±al, oclog.persistent.history 
	\033[38;5;11m¬ª \\033[38;5;118mclosclo \\033[38;5;195mpara terminar el d√≠a; la \\033[38;5;11mse√±al \\033[38;5;118mseta TODAS a \\033[38;5;218mfalse   
‚ú®\033[38;5;195m Y usar \\033[38;5;43m\`wog\`\\033[38;5;195mpara confirmar\\033[38;5;212m ‚ù§Ô∏èÔ∏è \\n"
}

## SOURCES 
##VARS-FILES 
##FUNCTIONS 
source Opte.fu
source Asksure.fu
source Continua.fu

function vlating() {
	# $1 = bashrc ‚Üí senal ‚Üí currentclop=true
	currentclop=$(echo $1 | awk -F= '{print $1}')
	functionpendig="f.*${currentclop}Pending"
    tolinu=$(grep -n ${functionpendig} /Users/violetagonzalezgarcia/gitclones/bin/lat)
	linu=$(echo ${tolinu} | awk -F: '{print $1}')
#	echo -e "VLATING ‚Üí 
#	\033[38;5;228m currentclop ‚Üí \t\033[38;5;218m ${currentclop} 
#	\033[38;5;228m tolinu ‚Üí \t\t\033[38;5;218m${tolinu}
#	\033[38;5;228m linu ‚Üí \t\t\033[38;5;218m${linu}
#	\033[38;5;228m functionpendig ‚Üí ${functionpendig}   
#	"  
	vim +${linu} $2
}	


##DIRECTORIES 
clodir=/Users/violetagonzalezgarcia/gitclones/.clogs/maestros
#prodir=/Users/violetagonzalezgarcia/gitclones/PROYECTO
##FILES
bashrc=/Users/violetagonzalezgarcia/gitclones/.bashrc
latfile=/Users/violetagonzalezgarcia/gitclones/bin/lat
#clogmaestro=""
#VARIABLES

while getopts ":eh" o; do
	case ${o} in
		e)
			opte
			exit
			;;
		h)
			whatis
			exit
			;; 
		?)
			echo -e "Nein nein nein option ‚Üí ${o}"
			exit
			;;
	esac
    
done
shift $((OPTIND-1))

### MAIN 
#si la senal est√° vacia, estamos empezando el d√≠a  y pasamos al select directamente para ‚áí  clomanov primero, then to PROYECTO and lat
senal=$(sed -ne "/^geus=/,/^extendother=/p" /Users/violetagonzalezgarcia/gitclones/.bashrc | grep true)

#si hay algo: run clomanow (resumen de lo hecho); then vlating con la senal que haya (apuntar lo que se qued√≥ pendiente, y lo nuevo que hay que hacer), y then lat con la nueva senal
if [[ ${senal} != "" ]]; then
	clomanow -v
	vlating ${senal} ${latfile}  
fi

clear
select malo in $(find ${clodir} -type f -name "*maestro" -exec basename {} \; | sed -ne "s/.log.maestro//p" ) 
do
	clomaestro=${clodir}/${malo}.log.maestro 
	if [[ $1 == "ave" ]]; then
		for i in $(grep -n "^<abre-log" ${clomaestro} )
		do
			tolinu=$i
		done
		linu=$(echo ${tolinu} | awk -F: '{print $1}')
		sed -ne "${linu},$ p" ${clomaestro} 
	else
		vim +$ ${clomaestro} 
		if [[ ${malo} != "extend-other" ]]; then
			echo -e "\033[38;5;118mView extend maestro as well??ü§Ø??"
		   if asksure; then
			   echo -e "\033[38;5;195m" 
			   vim ${clodir}/extend-other.log.maestro	   
		   fi
		fi
	fi
	break
done	

clogclop=$([[ ${malo} =~ "-" ]] && echo ${malo} | sed -ne "s/-//gp" || echo ${malo} )
vim -c "call ClopClog(\"${clogclop}\")" -c "wq" ${bashrc}

cd /Users/violetagonzalezgarcia/gitclones/PROYECTO
bash /Users/violetagonzalezgarcia/gitclones/bin/lat "${clogclop}"
bash
